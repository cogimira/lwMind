(function(t){function e(e){for(var i,o,h=e[0],c=e[1],s=e[2],l=0,u=[];l<h.length;l++)o=h[l],a[o]&&u.push(a[o][0]),a[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);d&&d(e);while(u.length)u.shift()();return r.push.apply(r,s||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,h=1;h<n.length;h++){var c=n[h];0!==a[c]&&(i=!1)}i&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},a={app:0},r=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var h=window["webpackJsonp"]=window["webpackJsonp"]||[],c=h.push.bind(h);h.push=e,h=h.slice();for(var s=0;s<h.length;s++)e(h[s]);var d=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var i=n("64a9"),a=n.n(i);a.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("2b0e"),a=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},r=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("canvas",{attrs:{id:"canvas"}})])}],o=n("d225"),h=n("b0b4"),c=n("308d"),s=n("6bb5"),d=n("013f"),l=n("4e2b"),u=n("faa1"),f=n.n(u),g=(n("ac6a"),n("5df3"),n("4f7f"),function(t){function e(t){var n;Object(o["a"])(this,e),n=Object(c["a"])(this,Object(s["a"])(e).call(this)),t||(t=document),n.targetSet=new Set;var i=n.mouseUp.bind(Object(d["a"])(n)),a=n.mouseMove.bind(Object(d["a"])(n)),r=n.mouseDown.bind(Object(d["a"])(n)),h=n.click.bind(Object(d["a"])(n));return t.addEventListener("mouseup",i),t.addEventListener("mousemove",a),t.addEventListener("click",h),t.addEventListener("mousedown",r),n}return Object(l["a"])(e,t),Object(h["a"])(e,[{key:"addListenTarget",value:function(t){this.targetSet.add(t)}},{key:"deleteListenTarget",value:function(t){this.targetSet.delete(t)}},{key:"mouseUp",value:function(t){this.targetSet.forEach(function(e){e.mouseUp&&"function"===typeof e.mouseUp&&e.mouseUp(t)})}},{key:"mouseMove",value:function(t){this.targetSet.forEach(function(e){e.mouseMove&&"function"===typeof e.mouseMove&&e.mouseMove(t)})}},{key:"mouseDown",value:function(t){this.targetSet.forEach(function(e){e.mouseDown&&"function"===typeof e.mouseDown&&e.mouseDown(t)})}},{key:"click",value:function(t){this.targetSet.forEach(function(e){e.click&&"function"===typeof e.click&&e.click(t)})}}]),e}(f.a)),v=(n("f400"),function(){function t(){var e=this;Object(o["a"])(this,t),this.keyDownMap=new Map,this.keyDownSet=new Set,this.checkKeys=new Set,this.keys={a:65,b:66,c:67,d:68,ctr:17,e:69,s:83,w:87,command:91,option:18,shift:16},this.initCheckKey(),document.addEventListener("keydown",function(t){e.checkKeys.has(t.keyCode)&&e.keyDownSet.add(t.keyCode)}),document.addEventListener("keyup",function(t){e.keyDownSet.delete(t.keyCode)})}return Object(h["a"])(t,[{key:"initCheckKey",value:function(){for(var t in this.keys)this.checkKeys.add(this.keys[t])}},{key:"checkKeysDown",value:function(t){for(var e=!0,n=0;n<t.length;n++){var i=t[n];if(!this.keys[i])return!1;var a=this.keys[i];if(!this.keyDownSet.has(a))return e=!1,e}return e}}]),t}()),y=new v,w={eventOffsetDom:function(t,e){var n=e.getBoundingClientRect(),i=t.clientX,a=t.clientY;return{x:i-n.left,y:a-n.top}}},b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",k=function(){for(var t=20,e=b.length,n=[],i=0;i<t;i++)n[i]=b.charAt(Math.random()*e);return n.join("")},p=k,x=function(t){function e(t,n,i,a){var r;return Object(o["a"])(this,e),r=Object(c["a"])(this,Object(s["a"])(e).call(this)),r.uuid=t||p(),r.startNode=n,r.endNode=i,r.type=a,r}return Object(l["a"])(e,t),e}(f.a),m={ctx:null,canvasRender:null},O=function(t){function e(t,n,i,a,r,h){var d;return Object(o["a"])(this,e),d=Object(c["a"])(this,Object(s["a"])(e).call(this)),d.uuid=t||p(),d.x=i,d.y=a,d.r=r,d.type=n,d.label=h||"默认值",d.directOutEdges=[],d.directInEdges=[],d}return Object(l["a"])(e,t),Object(h["a"])(e,[{key:"linkToTheNode",value:function(t,e){var n=new x(null,this,t,e),i=this.findSameEdgeAndTargetNode(e,t);i||(this.directOutEdges.push(n),t.directInEdges.push(n))}},{key:"findSameEdgeAndTargetNode",value:function(t,e){for(var n=0;n<this.directOutEdges.length;n++){var i=this.directOutEdges[n];if(t===i.edgeType){var a=i.endNode;if(e===a&&e.uuid===a.uuid)return e}}return null}},{key:"render",value:function(t){var e=m.canvasRender;e&&e.renderNode(this)}}]),e}(f.a),j=function(){function t(){Object(o["a"])(this,t),this.nodeMap=new Map,this.edgeMap=new Map}return Object(h["a"])(t,[{key:"tick",value:function(t){this.nodeMap.forEach(function(t,e){m.canvasRender&&t.render(m.canvasRender)})}}]),t}(),R=new j,M=function(t){function e(){return Object(o["a"])(this,e),Object(c["a"])(this,Object(s["a"])(e).call(this))}return Object(l["a"])(e,t),Object(h["a"])(e,[{key:"addNodeAtPosition",value:function(t,e){var n=new O(null,null,t,e,15);R.nodeMap.set(n.uuid,n)}}]),e}(f.a),C=(new M,n("6c7b"),function(){function t(e){Object(o["a"])(this,t),this.canvas=e,this.context=e.getContext("2d"),this.ratio=this.getPixelRatio(this.context),this.translate={x:0,y:0}}return Object(h["a"])(t,[{key:"setTranslate",value:function(t,e){this.context.translate(-this.translate.x,-this.translate.y),this.context.translate(t,e),this.translate.x=t,this.translate.y=e}},{key:"getPixelRatio",value:function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e}},{key:"renderNode",value:function(t){this.context.save(),this.context.translate(t.x,t.y),this.context.beginPath(),this.context.arc(0,0,t.r/2,0,2*Math.PI),this.context.fill(),this.context.restore()}},{key:"clear",value:function(){this.context.clearRect(-1e3,-1e3,1e3+this.canvas.width,1e3+this.canvas.height)}},{key:"renderMindRoot",value:function(t){if(this.renderMindNode(t),t.children.length)for(var e=0;e<t.children.length;e++)this.renderMindRoot(t.children[e])}},{key:"renderMindNode",value:function(t){if(this.context.save(),this.context.translate(t.showObjRect.x,t.showObjRect.y),this.context.fillStyle=t.color,this.context.beginPath(),this.context.rect(0,0,t.showObjRect.width,t.showObjRect.height),this.context.stroke(),this.context.fill(),this.context.restore(),this.context.save(),this.context.translate(t.showObjRect.x,t.showObjRect.y),this.context.beginPath(),this.context.fillStyle="white",this.context.font="18px serif",this.context.textAlign="center",this.context.fillText(t.text,t.showObjRect.width/2,t.showObjRect.height/2+9),this.context.fill(),this.context.restore(),t.parent){this.context.save(),this.context.translate(t.showObjRect.x,t.showObjRect.y+t.showObjRect.height/2),this.context.beginPath(),this.context.moveTo(0,0);var e=t.parent.showObjRect,n={x:e.x+e.width-t.showObjRect.x,y:e.y+e.height/2-(t.showObjRect.y+t.showObjRect.height/2)};this.context.lineTo(n.x,n.y),this.context.stroke(),this.context.restore()}}}]),t}()),S=function(){function t(){Object(o["a"])(this,t),this._targetTickSet=new Set,this._targetTickSet.add(R)}return Object(h["a"])(t,[{key:"addTickTarget",value:function(t){this._targetTickSet.add(t)}},{key:"deleteTickTarget",value:function(t){this._targetTickSet.delete(t)}},{key:"tick",value:function(t){this._targetTickSet.forEach(function(e){e.tick&&"function"===typeof e.tick&&e.tick(t)})}}]),t}(),E=(new S,f.a,function(){function t(){Object(o["a"])(this,t),this.roots=[]}return Object(h["a"])(t,[{key:"addRoot",value:function(t){t.parent||this.roots.push(t)}},{key:"render",value:function(t){for(var e=0;e<this.roots.length;)this.roots[e].render(t)}}]),t}()),T=function(){function t(e,n,i,a){Object(o["a"])(this,t),this.x=e,this.y=n;var r=["red","black","green","pink","blue","orange"];this.color=r[parseInt(Math.random()*r.length)],this.text=parseInt(20*Math.random())+"",this.width=i||50,this.height=a||20,this.marginVertical=5,this.marginHorizontal=40,this.marginWidth=this.width+2*this.marginHorizontal,this.marginHeight=this.height+2*this.marginVertical,this.parent=null,this.children=[],this.showObjRect={x:this.x,y:this.y,width:this.width,height:this.height}}return Object(h["a"])(t,[{key:"getMarginRect",value:function(){return{x:this.x-this.marginHorizontal,y:this.y-this.marginHeight/2+this.height/2,width:this.marginWidth,height:this.marginHeight}}},{key:"getChildrenMarginHeight",value:function(){for(var t=0,e=0;e<this.children.length;e++){var n=this.children[e];t+=n.marginHeight}return t}},{key:"addChild",value:function(t){this.children.push(t),t.parent&&(t.parent.marginHeight-=t.marginHeight,t.parent.deleteChild(t)),t.parent=this,this.recursionCalMarginRect(t)}},{key:"recursionCalMarginRect",value:function(t){if(t.parent){var e=t.parent.getChildrenMarginHeight();if(!(e<=t.parent.marginHeight)){var n=t.parent;n.marginHeight=e,this.recursionCalMarginRect(n)}}}},{key:"afterDeleteChildRect",value:function(t){var e=t.getChildrenMarginHeight();t.marginHeight=e,t.parent&&this.afterDeleteChildRect(t.parent)}},{key:"deleteChild",value:function(t){for(var e=0;e<this.children.length;e++)t==this.children[e]&&this.children.splice(e,1);this.afterDeleteChildRect(this)}},{key:"calMarginRect",value:function(){for(var t={width:this.width+2*this.marginHorizontal,height:this.height+2*this.marginVertical},e=0,n=0;n<this.children.length;n++){var i=this.children[n];e+=i.marginHeight}return t.height=t.height>e?t.height:e,t}},{key:"calLayout",value:function(t,e){for(var n=t.getChildrenMarginHeight(),i=t.x+t.marginWidth,a=t.y+t.height/2-n/2,r=0,o=0;o<t.children.length;o++){var h=t.children[o];h.showObjRect.x=i,h.x=i,h.showObjRect.y=a+r+h.marginHeight/2-h.height/2,h.y=h.showObjRect.y,r+=h.marginHeight}for(var c=0;c<t.children.length;c++)this.calLayout(t.children[c],++e)}},{key:"render",value:function(t){this.calLayout(this,1),t.renderMindRoot(this)}},{key:"click",value:function(e,n,i){var a={x:this.x,y:this.y,width:this.width,height:this.height},r={x:e-a.x,y:n-a.y};if(r.x>0&&r.x<a.width&&r.y>0&&r.y<a.height){console.log(this);var o=100*Math.random()+2,h=new t(0,0,50,o);i?this.addChild(h):this.parent.deleteChild(this)}else if(this.children.length)for(var c=0;c<this.children.length;c++)this.children[c].click(e,n,i)}}]),t}(),P=function(t){function e(t,n){var i;return Object(o["a"])(this,e),i=Object(c["a"])(this,Object(s["a"])(e).call(this)),i.container=n.container,i.canvas=t,i.canvasEventer=new g(t),i.canvasEventer.addListenTarget(Object(d["a"])(i)),i.canvasRender=new C(t),i.test(),i}return Object(l["a"])(e,t),Object(h["a"])(e,[{key:"test",value:function(){new E;var t=new T(100,400,50,20);this.rootMindNode=t;var e=new T(100,250,50,20),n=new T(100,250,50,20),i=new T(100,250,50,20);t.addChild(e),t.addChild(n),t.addChild(i);var a=new T(100,250,50,20),r=new T(100,250,50,20),o=new T(100,250,50,90),h=new T(100,250,50,20),c=new T(100,250,50,20),s=new T(100,250,50,20);e.addChild(a),e.addChild(r),e.addChild(o),e.addChild(h),e.addChild(c),e.addChild(s);var d=new T(100,250,50,20),l=new T(100,250,50,70),u=new T(100,250,50,20),f=new T(100,250,50,20);n.addChild(d),n.addChild(l),n.addChild(u),n.addChild(f);var g=new T(100,250,50,20),v=new T(100,250,50,20),y=new T(100,250,50,50),w=new T(100,250,50,20);l.addChild(g),l.addChild(v),l.addChild(y),l.addChild(w),t.render(this.canvasRender),window.rootMindNode=t}},{key:"mouseMove",value:function(t){if(this.isDragging){var e=w.eventOffsetDom(t,this.canvas),n={x:e.x-this.startPosition.x,y:e.y-this.startPosition.y};this.canvasRender.setTranslate(n.x,n.y),console.log(n.x,n.y),this.canvasRender.clear(),this.rootMindNode.render(this.canvasRender)}}},{key:"mouseDown",value:function(t){this.isDragging=!0,this.startPosition=w.eventOffsetDom(t,this.canvas)}},{key:"mouseUp",value:function(t){this.isDragging=!1}},{key:"click",value:function(t){var e=w.eventOffsetDom(t,this.canvas);e.x-=this.canvasRender.translate.x,e.y-=this.canvasRender.translate.y,y.checkKeysDown(["command"])?(this.rootMindNode.click(e.x,e.y,!1),this.canvasRender.clear(),this.rootMindNode.render(this.canvasRender)):(this.rootMindNode.click(e.x,e.y,!0),this.canvasRender.clear(),this.rootMindNode.render(this.canvasRender))}}]),e}(f.a),D={name:"app",methods:{},mounted:function(){var t=document.getElementById("canvas");t.setAttribute("width",document.body.offsetWidth),t.setAttribute("height",window.innerHeight);var e=document.getElementById("app");new P(t,{container:e})},components:{}},H=D,N=(n("034f"),n("2877")),_=Object(N["a"])(H,a,r,!1,null,null,null),L=_.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(L)}}).$mount("#app")},"64a9":function(t,e,n){}});
//# sourceMappingURL=app.f982757a.js.map